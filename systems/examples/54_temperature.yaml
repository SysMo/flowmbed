imports:
  - package: flowmbed_core_blocks
    paths:
      - sensors
      - sinks
      - actuators
      - discrete

devices:
  - id: esp_dev
    config:
      type: ESP32
      peripherals:
        # - id: adc1
        #   config:
        #     type: AnalogReader
        #     adc: adc1
        #     resolution: 10bit
        #     calibration: true
        #     pin: 33
        #     attenuation: 11dB
        - id: adc1
          config:
            type: AnalogReaderMultiChannel
            adc: adc1
            resolution: 10bit
            calibration: true
            channels:
              - pin: 32
                attenuation: 11dB
              - pin: 33
                attenuation: 11dB
              

        - id: button1
          config:
            type: DigitalInputPin
            pin: 5
            pull: up

        - id: led1
          config:
            type: DigitalOutputPin
            pin: 2


        - id: led_pwm_1
          config:
            type: PwmMultiChannel
            timer:
              - 
            channels:
              - pin: 4
              - pin: 6
        # - id: t1
        #   config: 
        #     type: DS18B20Array
        #     pin: 
        #       type: DigitalInOutPin
        #       pin: 4
        #       open_drain: true

        - id: serial1
          config:
            type: SerialValueSink
        - id: serial2
          config:
            type: SerialValueSink

circuits:
  - id: TempMeasCircuit
    device: esp_dev
    blocks:
      - id: sensor_adc
        kind: sensors::AnalogReaderMultiChannelBlock
        peripherals:
          sensor: adc1

      - id: sensor_button
        kind: sensors::DigitalReaderBlock
        peripherals:
          sensor: button1

      - id: count_trigger
        kind: discrete::CountingTrigger
        parameters:
          pulses_up: 1
          pulses_down: 2
          initial_count: 0        

      - id: print1
        kind: sinks::FloatSink
        peripherals:
          sink: serial1
      - id: print2
        kind: sinks::FloatSink
        peripherals:
          sink: serial2

      - id: led1
        kind: actuators::DigitalOutput
        peripherals:
          output: led1



    connections:
      - count_trigger.input: sensor_button.output
      - led1.input: count_trigger.output
      - print1.input: sensor_adc.output1
      - print2.input: sensor_adc.output2

tasks:
  - !FixedStepTask
      id: MainTask
      circuit: TempMeasCircuit
      t_step: 0.1
      speedup: 1.0