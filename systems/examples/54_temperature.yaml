imports:
  - package: flowmbed_core_blocks
    paths:
      - sensors
      - sinks
      - actuators
      - discrete

devices:
  - id: esp_dev
    config:
      type: ESP32
      peripherals:
        - id: adc1
          config:
            type: AnalogInputPin
            adc: adc1
            resolution: 10bit
            calibration: true
            attenuation: 11dB
            pin: 33

        - id: button1
          config:
            type: DigitalInputPin
            pin: 16
            pull: up

        - id: led1
          config:
            type: DigitalOutputPin
            pin: 2


        # - id: t1
        #   config: 
        #     type: DS18B20Array
        #     pin: 
        #       type: DigitalInOutPin
        #       pin: 4
        #       open_drain: true

        - id: serial1
          config:
            type: SerialValueSink
        - id: serial2
          config:
            type: SerialValueSink

circuits:
  - id: TempMeasCircuit
    device: esp_dev
    blocks:
      - id: sensor_adc
        kind: sensors::OneShotAnalog
        peripherals:
          sensor: adc1

      - id: sensor_button
        kind: sensors::OneShotDigital
        peripherals:
          sensor: button1

      - id: count_trigger
        kind: discrete::CountingTrigger
        parameters:
          pulses_up: 1
          pulses_down: 2
          initial_count: 0        

      - id: print1
        kind: sinks::FloatSink
        peripherals:
          sink: serial1
      - id: print2
        kind: sinks::FloatSink
        peripherals:
          sink: serial2

      - id: led1
        kind: actuators::DigitalOutput
        peripherals:
          output: led1



    connections:
      - count_trigger.input: sensor_button.output
      - led1.input: count_trigger.output
      - print1.input: sensor_adc.output
      - print2.input: sensor_adc.output

tasks:
  - !FixedStepTask
      id: MainTask
      circuit: TempMeasCircuit
      t_step: 0.01
      speedup: 1.0