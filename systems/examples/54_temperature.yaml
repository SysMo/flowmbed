imports:
  - package: flowmbed_core_blocks
    paths:
      - sensors
      - sinks

devices:
  - id: esp_dev
    config:
      type: ESP32
      peripherals:
        - id: adc1
          config:
            type: AnalogInputPin
            adc: adc2
            resolution: 9bit
            calibration: true
            pin: 12
            attenuation: 6dB

        # - id: button1
        #   config:
        #     type: DigitalInputPin
        #     pin: 9

        # - id: led1
        #   config:
        #     type: DigitalOutputPin
        #     pin: 2


        # - id: t1
        #   config: 
        #     type: DS18B20Array
        #     pin: 
        #       type: DigitalInOutPin
        #       pin: 4
        #       open_drain: true

        - id: serial
          config:
            type: SerialValueSink

circuits:
  - id: TempMeasCircuit
    device: esp_dev
    blocks:
      - id: sensor_adc
        kind: sensors::OneShotAnalog
        peripherals:
          sensor: adc1

      - id: sink_adc
        kind: sinks::FloatSink
        peripherals:
          sink: serial

      # - id: sink_button
      #   kind: sinks::BoolSink
      #   peripherals:
      #     sink: serial

    connections:
      - sink_adc.input: sensor_adc.output


tasks:
  - !FixedStepTask
      id: MainTask
      circuit: TempMeasCircuit
      t_step: 0.01
      speedup: 1.0